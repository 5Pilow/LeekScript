var cache = [12: 12] cache.erase(12)

function sequence_length(number) {
	var l = 1
	var n = 0l
	n += number
	while n != 1 {
		l++
		if (n % 2) { // TODO replace with a match (doesn't work)
			n = 3 * n + 1
		} else {
			n = n \ 2
		}
		if n in cache {
			return l + cache[n]
		} else if (n < 20000) {
			var ni = 0
			ni += n
			cache.insert(ni, l)
		}
	}
	l // TODO return l fails
}

var max = 0
var n = 0

for var i = 500001; i <= 1000000; i += 2Â {
	var l = sequence_length(i)
	if l > max {
		max = l
		n = i
	}
}

return n
